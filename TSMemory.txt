

    TSMemory ver.0.2.1 改造版


TSMemory は、TVTest と AviUtl を連携させて映像メモリ機能を実現するための
プラグインセットです。
静止画キャプチャ用途での使用を想定しています。

現在、テスト用の人柱版となっています。
TVTest ver.0.9.0-develop と AviUtl 1.00 で動作確認しています。


導入方法

  少し手順が煩雑ですが、以下のようにしてください。

1. TVTest の Plugins フォルダに TSMemory.tvtp と TSMemory.ini を入れます。
2. TSMemory.ini ファイルを開いて、メモリのサイズと AviUtl のパスを設定します。
3. AviUtl のフォルダに TVTestSrc.aui と TVTestSrc.ini、CaptureUtil.auf の3つのファイルを入れます。
   また、TVTest に付属の TVTest_Image.dll もコピーします
   (CaptureUtil.auf で画像の保存に使います)。
4. 必要に応じて TVTestSrc.ini ファイルを編集して設定を変更してください。
5. AviUtl を起動して、メニューの [ファイル] -> [環境設定] -> [入力プラグイン優先度の設定] を選択して、
   TVTest Video Reader を一番上に移動します。
   また、[システムの設定] を選択して、最大画像サイズを 1920x1080 以上にしておきます。
   設定を行ったら AviUtl を終了させます。
6. TVTest を起動し、メニューの [設定] で設定ダイアログを表示させ、
   左のリストから [キー割り当て] を選択して、TSMemory の実行にキーを割り当てます。
7. メニューの [プラグイン] から、TSMemory をチェック状態にします。


使い方

1. キャプチャしたいシーンになったら、導入の 6 で割り当てたキーを押します。
   AviUtl が起動して、映像メモリの内容が読み込まれるはずです。
2. AviUtl の表示メニューから「キャプチャ・ユーティリティ」を選択すると、
   キャプチャ・ユーティリティのウィンドウが表示されます。
   上段に保存する画像のファイル名を入力します。
   ファイル名の拡張子が省略されている場合は拡張子が付加されます。
   既に同名のファイルが存在する場合は、ベース名の末尾に連番が付加されます。
   下段左端でフォーマットを選択、その右側で JPEGの品質 と PNG の圧縮レベルを指定します。
3. 「保存」ボタンを押すと画像がファイルに保存されます。
4. 以後、キャプチャ実行キーを押すと AviUtl で読み込まれます。


ヒント

・AviUtl でのシーク操作が重い場合は、TVTestSrc.ini の aspect_ratio を 0 に設定
  して AviUtl の側でリサイズ処理するようにすれば大分軽くなります。
・画像の保存時にファイル名をクリップボードにコピーしたい場合は、CaptureUtil.ini
  ファイルに CopyFileName=1 を追加してください。


注意

・このプログラムによるいかなる損害も補償しません。
・音声には対応していません。


謝辞

TVTestSrc.aui は茂木和洋氏の開発した MPEG-2 VIDEO VFAPI Plug-In を元にしています。
このような有用なプログラムを開発・公開して下さっている茂木氏に感謝します。


動作原理

映像メモリ機能を実行すると、TSMemory.tvtp と同じフォルダに tsmemory*.tvtv という
名前の 0 バイトのダミーファイルが作成されます。
このダミーファイルを引数に渡して AviUtl を起動します。
TVTestSrc.aui では、拡張子が .tvtv のファイルが読み込まれると、
ファイル名と同じ名前の付けられた共有メモリから TS データを取得して開きます。
既に起動している AviUtl に対しては、WM_DROPFILES メッセージを送って開かせています。


更新履歴
ver.0.2.1 改造版
  ・TVTestSrc.aui を MPEG-2 VIDEO VFAPI Plug-In ver.0.7.14 ベースに変更
  ・ソリューション・プロジェクトを Visual Studio 2019 用に変更

ver.0.2.1
  ・TVTest の終了時に AviUtl も終了させるオプションを追加した
  ・ver.0.2.0 で、2回目以降の WM_DROPFILES の処理が正しく行えなくなっていた不具
    合を修正
  ・AviUtl をアクティブにする設定をデフォルトにした

ver.0.2.0
  ・TVTest の複数起動に対応した
  ・実行時に AviUtl をアクティブにする機能を追加した
  ・画像の保存時にファイル名をクリップボードにコピーする機能を追加した
  ・データがメモリサイズいっぱいにならないと正常に動作しない不具合を修正
  ・TVTestSrc.ini の説明が一部おかしかったのを修正
  ・その他細かい修正

ver.0.1.0
  ・最初のリリース

